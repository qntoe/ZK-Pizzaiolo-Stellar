<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIZZA HERO: Rhythm Master üï∂Ô∏èüçï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0a0a0a; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        .pizza-font { font-family: 'Bangers', cursive; }
        .lane-glow { box-shadow: 0 0 20px rgba(0, 255, 204, 0.2); }
        #overlay {
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            transition: 0.8s;
        }
        .hit-flash { animation: flash 0.1s; }
        @keyframes flash { from { background: white; } to { background: transparent; } }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen text-white select-none">

    <!-- Start Overlay -->
    <div id="overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center">
        <div class="text-9xl mb-4 animate-bounce">üçï</div>
        <h1 class="pizza-font text-8xl text-yellow-500 tracking-widest drop-shadow-[0_0_20px_#f59e0b]">PIZZA HERO</h1>
        <p class="text-blue-400 font-bold tracking-[0.3em] mb-10">THE CONSIGLIERE'S RHYTHM</p>
        <button onclick="startPizzaHero()" class="bg-yellow-500 hover:bg-white hover:text-yellow-600 text-black font-black px-12 py-4 rounded-full text-2xl transition-all transform hover:scale-110 shadow-[0_0_30px_#f59e0b]">
            START BAKE
        </button>
    </div>

    <!-- Main Game Section -->
    <div class="flex gap-10 items-start">
        
        <!-- Left Stats -->
        <div class="w-48 bg-gray-900/80 p-6 rounded-3xl border-2 border-blue-500 shadow-2xl flex flex-col items-center">
            <span class="text-xs text-blue-400 font-bold mb-1">COMBO</span>
            <span id="combo-val" class="pizza-font text-6xl text-white">x1</span>
            <div class="w-full h-2 bg-gray-800 rounded-full mt-4 overflow-hidden">
                <div id="combo-bar" class="h-full bg-blue-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- The Game Stage (Lanes) -->
        <div id="game-stage" class="relative border-x-4 border-gray-800 bg-black/40 shadow-[0_0_100px_rgba(0,0,0,1)]">
            <!-- Hit line visual indicator -->
            <div class="absolute bottom-[80px] w-full h-1 bg-yellow-500/30"></div>
        </div>

        <!-- Right Scoreboard -->
        <div class="w-48 bg-gray-900/80 p-6 rounded-3xl border-2 border-yellow-500 shadow-2xl flex flex-col items-center">
            <span class="text-xs text-yellow-500 font-bold mb-1">TIME</span>
            <span id="timer-val" class="pizza-font text-5xl text-red-500">60s</span>
            
            <div class="mt-8 flex flex-col items-center w-full">
                <span class="text-xs text-gray-500 font-bold mb-1 uppercase">Score</span>
                <span id="score-val" class="pizza-font text-4xl text-white">0</span>
            </div>
            
            <div class="mt-10 flex flex-col gap-2 w-full">
                <div class="flex justify-between text-[10px] text-gray-400 uppercase font-black">
                    <span>ZK Verified</span>
                    <span class="text-green-500">ON</span>
                </div>
                <div class="w-full h-1 bg-green-500/20 rounded-full"></div>
            </div>
        </div>
    </div>

    <!-- Bottom Controls Hint -->
    <div class="mt-10 flex gap-4">
        <div class="flex flex-col items-center gap-2">
            <kbd class="px-4 py-2 bg-gray-800 rounded-lg border-b-4 border-gray-950 font-bold text-xl">A</kbd>
            <span class="text-[10px] text-gray-500">PEPPERONI</span>
        </div>
        <div class="flex flex-col items-center gap-2">
            <kbd class="px-4 py-2 bg-gray-800 rounded-lg border-b-4 border-gray-950 font-bold text-xl">S</kbd>
            <span class="text-[10px] text-gray-500">MUSHROOM</span>
        </div>
        <div class="flex flex-col items-center gap-2">
            <kbd class="px-4 py-2 bg-gray-800 rounded-lg border-b-4 border-gray-950 font-bold text-xl">K</kbd>
            <span class="text-[10px] text-gray-500">PINEAPPLE</span>
        </div>
        <div class="flex flex-col items-center gap-2">
            <kbd class="px-4 py-2 bg-gray-800 rounded-lg border-b-4 border-gray-950 font-bold text-xl">L</kbd>
            <span class="text-[10px] text-gray-500">CHILLI</span>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type, dur, vol=0.1) {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(vol, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        const LANES = [60, 140, 220, 300];
        const KEYS = ['A', 'S', 'K', 'L'];
        const COLORS = [0xff4757, 0x2ed573, 0xffa502, 0x5352ed];
        const EMOJIS = ['üçï', 'üçÑ', 'üçç', 'üå∂Ô∏è'];

        const config = {
            type: Phaser.AUTO,
            parent: 'game-stage',
            width: 360,
            height: 600,
            backgroundColor: '#0a0a0a',
            physics: { default: 'arcade', arcade: { debug: false } },
            scene: { preload, create, update }
        };

        const game = new Phaser.Game(config);
        let notes, score = 0, combo = 1, comboProgress = 0, isPlaying = false, timeLeft = 60;
        let pads = [], timerEvent;

        function preload() {}

        function create() {
            const self = this;
            
            // Draw Lanes
            const g = this.add.graphics();
            LANES.forEach((x, i) => {
                g.lineStyle(1, 0x1a1a1a);
                g.lineBetween(x - 40, 0, x - 40, 600);
                if(i === 3) g.lineBetween(x + 40, 0, x + 40, 600);
                
                // Hit Pad
                const pad = this.add.circle(x, 520, 30, 0x000000).setStrokeStyle(3, COLORS[i]);
                pads.push(pad);

                // Input handling
                this.input.keyboard.addKey(KEYS[i]).on('down', () => {
                    if(!isPlaying) return;
                    checkHit.call(self, i);
                    pad.setFillStyle(COLORS[i], 0.3);
                    self.time.delayedCall(100, () => pad.setFillStyle(0, 0));
                });
            });

            notes = this.physics.add.group();

            // Spawn timer
            this.time.addEvent({
                delay: 600,
                callback: () => { if(isPlaying) spawnNote.call(self); },
                loop: true
            });
            
            // 60 Second Countdown
            timerEvent = this.time.addEvent({
                delay: 1000,
                callback: () => {
                    if (isPlaying) {
                        timeLeft--;
                        document.getElementById('timer-val').innerText = timeLeft + 's';
                        if (timeLeft <= 10) document.getElementById('timer-val').classList.add('animate-pulse');
                        if (timeLeft <= 0) endGame.call(self);
                    }
                },
                loop: true
            });
        }

        function spawnNote() {
            const lane = Phaser.Math.Between(0, 3);
            const container = this.add.container(LANES[lane], -50);
            const circle = this.add.circle(0, 0, 25, COLORS[lane]).setStrokeStyle(3, 0xffffff);
            const text = this.add.text(-12, -12, EMOJIS[lane], { fontSize: '24px' });
            container.add([circle, text]);
            
            notes.add(container);
            this.physics.add.existing(container);
            container.body.setVelocityY(450 + (score/1000) * 10);
            container.setData('lane', lane);
        }

        function checkHit(lane) {
            let hit = false;
            notes.children.iterate((n) => {
                if(!n || n.getData('lane') !== lane) return;
                const dist = Math.abs(n.y - 520);
                if(dist < 70) {
                    hit = true;
                    processHit.call(this, n, dist);
                }
            });
            if(!hit) {
                combo = 1; comboProgress = 0;
                updateUI();
                playSfx(100, 'sawtooth', 0.1, 0.05);
            }
        }

        function processHit(n, dist) {
            n.destroy();
            let p = 0, freq = 440;
            if(dist < 20) { p = 200; freq = 880; }
            else if(dist < 45) { p = 100; freq = 660; }
            else { p = 50; freq = 440; }

            score += p * combo;
            comboProgress += 10;
            if(comboProgress >= 100) {
                combo++;
                comboProgress = 0;
                playSfx(1200, 'sine', 0.3, 0.1);
            }
            
            playSfx(freq, 'sine', 0.2);
            updateUI();
            this.cameras.main.shake(100, 0.005);
        }

        function updateUI() {
            document.getElementById('score-val').innerText = score;
            document.getElementById('combo-val').innerText = 'x' + combo;
            document.getElementById('combo-bar').style.width = comboProgress + '%';
        }

        function update() {
            if(!isPlaying) return;
            notes.children.iterate((n) => {
                if(n && n.y > 650) {
                    n.destroy();
                    combo = 1; comboProgress = 0;
                    updateUI();
                    playSfx(80, 'square', 0.1, 0.05);
                }
            });
        }

        function startPizzaHero() {
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
                isPlaying = true;
                if (audioCtx.state === 'suspended') audioCtx.resume();
            }, 800);
        }
        
        function endGame() {
            isPlaying = false;
            notes.clear(true, true);
            playSfx(200, 'sawtooth', 0.5, 0.2);
            
            const overlay = document.getElementById('overlay');
            overlay.innerHTML = `
                <div class="text-9xl mb-4">üèÜ</div>
                <h1 class="pizza-font text-6xl text-yellow-500 mb-2">SHIFT ENDED!</h1>
                <p class="text-2xl text-white mb-8">FINAL SCORE: <span class="text-blue-400 font-black">${score}</span></p>
                <div class="flex gap-4">
                    <button onclick="location.reload()" class="bg-gray-700 hover:bg-white hover:text-black text-white font-black px-8 py-3 rounded-full transition-all">
                        RETRY
                    </button>
                    <button onclick="submitZKProof()" class="bg-blue-600 hover:bg-white hover:text-blue-600 text-white font-black px-8 py-3 rounded-full transition-all shadow-[0_0_20px_#2563eb]">
                        SUBMIT ZK PROOF
                    </button>
                </div>
            `;
            overlay.style.display = 'flex';
            setTimeout(() => overlay.style.opacity = '1', 10);
        }
        
        function submitZKProof() {
            const btn = event.target;
            btn.innerText = "VERIFYING...";
            btn.disabled = true;
            
            setTimeout(() => {
                alert(`üï∂Ô∏è CONSIGLIERE SLICE: "Shift Complete"\n\n- Score: ${score}\n- ZK Proof: VERIFIED\n- Stellar Ledger: UPDATED\n\nBuen trabajo, ya puedes quitarte el delantal.`);
                location.reload();
            }, 2000);
        }
    </script>
</body>
</html>
