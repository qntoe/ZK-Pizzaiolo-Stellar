<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK-Pizzaiolo: Rhythm Arcade üï∂Ô∏èüçï</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: #050505;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            color: #00ffcc;
        }
        #game-container {
            border: 4px solid #ff00ff;
            box-shadow: 0 0 30px #ff00ff, inset 0 0 15px #ff00ff;
            border-radius: 12px;
            background: #000;
        }
        .ui-panel {
            margin-top: 20px;
            text-align: center;
            background: rgba(0, 255, 204, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #00ffcc;
            width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-stellar {
            background: #ff00ff;
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            text-transform: uppercase;
            transition: 0.3s;
            box-shadow: 0 0 10px #ff00ff;
        }
        .btn-stellar:hover {
            background: #fff;
            color: #ff00ff;
            box-shadow: 0 0 20px #fff;
        }
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3.5rem;
            margin: 0 0 15px 0;
            color: #ff00ff;
            text-shadow: 0 0 15px #ff00ff, 0 0 30px #ff00ff;
        }
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: 0.5s;
        }
        .start-btn {
            font-size: 2rem;
            padding: 20px 40px;
            background: transparent;
            color: #ff00ff;
            border: 2px solid #ff00ff;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            box-shadow: 0 0 20px #ff00ff;
        }
        .start-btn:hover {
            background: #ff00ff;
            color: white;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="color: #fff; text-shadow: 0 0 20px #ff00ff;">CONSIGLIERE SLICE PRESENTS</h1>
        <h1 style="font-size: 5rem;">ZK-Pizzaiolo</h1>
        <p style="margin-bottom: 40px; color: #00ffcc;">UN JUEGO DE RITMO Y CONFIANZA ZK</p>
        <button class="start-btn" onclick="startGame()">START SESSION</button>
    </div>

    <h1>ZK-Pizzaiolo</h1>
    <div id="game-container"></div>

    <div class="ui-panel">
        <div>
            <div id="status" style="font-size: 1.2rem; font-weight: bold;">SCORE: 0 | COMBO: x1</div>
            <div style="font-size: 0.8rem; color: #666;">Teclas: [A] [S] [K] [L]</div>
        </div>
        <div id="feedback" style="font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px #fff;">WAITING...</div>
        <button class="btn-stellar" onclick="submitZKProof()">Submit to Stellar</button>
    </div>

    <script>
        // Audio Synth Engine
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playNote(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const config = {
            type: Phaser.AUTO,
            parent: 'game-container',
            width: 800,
            height: 600,
            physics: {
                default: 'arcade',
                arcade: { debug: false }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);
        const LANES = [200, 333, 466, 600];
        const KEYS = ['A', 'S', 'K', 'L'];
        const LANE_COLORS = [0x00ffcc, 0xff00ff, 0x00ffcc, 0xff00ff];
        
        let ingredients;
        let score = 0;
        let combo = 1;
        let isPlaying = false;
        let keyObjects = {};
        let hitZones = [];
        let scoreText;

        function preload() {}

        function create() {
            const self = this;
            
            // Background Effects
            const bgGraphics = this.add.graphics();
            this.gridY = 0;

            // Hit Zones & Lanes
            LANES.forEach((x, i) => {
                this.add.rectangle(x, 300, 40, 600, LANE_COLORS[i], 0.1);
                const zone = this.add.circle(x, 530, 40, 0x000000);
                zone.setStrokeStyle(3, LANE_COLORS[i]);
                hitZones.push(zone);

                this.add.text(x - 10, 560, KEYS[i], { 
                    fontFamily: 'Orbitron', fontSize: '18px', fill: '#00ffcc' 
                });

                keyObjects[KEYS[i]] = this.input.keyboard.addKey(KEYS[i]);
                keyObjects[KEYS[i]].on('down', () => {
                    if(!isPlaying) return;
                    checkHit.call(self, i);
                    zone.setFillStyle(LANE_COLORS[i], 0.3);
                    self.time.delayedCall(100, () => zone.setFillStyle(0, 0));
                });
            });

            ingredients = this.physics.add.group();

            // Spawn loop
            this.time.addEvent({
                delay: 600,
                callback: () => { if(isPlaying) spawnIngredient.call(self); },
                loop: true
            });
        }

        function spawnIngredient() {
            const lane = Phaser.Math.Between(0, 3);
            const x = LANES[lane];
            
            // Procedural Pizza Topping
            const type = Phaser.Math.Between(0, 2);
            let color = 0xff0000; // Pepperoni
            if(type === 1) color = 0x00ff00; // Pepper
            if(type === 2) color = 0xffcc00; // Cheese

            const ing = this.add.circle(x, -50, 25, color);
            ing.setStrokeStyle(3, 0xffffff);
            ing.setData('lane', lane);
            ingredients.add(ing);
            ing.body.setVelocityY(450 + (score/1000) * 10); // Dynamic speed
        }

        function checkHit(lane) {
            let hit = false;
            ingredients.children.iterate((ing) => {
                if (!ing || ing.getData('lane') !== lane) return;
                const dist = Math.abs(ing.y - 530);
                if (dist < 80) {
                    hit = true;
                    processHit.call(this, ing, dist);
                }
            });
            if (!hit) { combo = 1; playNote(100, 'sawtooth', 0.1); updateUI('MISS', '#ff0000'); }
        }

        function processHit(ing, dist) {
            ing.destroy();
            let p = 0, label = '', color = '', freq = 440;
            if (dist < 20) { p = 200; label = 'PERFECT!'; color = '#fffb00'; freq = 880; }
            else if (dist < 45) { p = 100; label = 'GOOD'; color = '#00ffcc'; freq = 660; }
            else { p = 50; label = 'OK'; color = '#ff00ff'; freq = 440; }

            score += p * combo; combo++;
            playNote(freq, 'sine', 0.2);
            updateUI(label, color);
            this.cameras.main.shake(100, 0.005);
        }

        function updateUI(label, color) {
            const fb = document.getElementById('feedback');
            fb.innerText = label; fb.style.color = color; fb.style.textShadow = `0 0 15px ${color}`;
            document.getElementById('status').innerText = `SCORE: ${score} | COMBO: x${combo}`;
        }

        function update() {
            if(!isPlaying) return;
            ingredients.children.iterate((ing) => {
                if (ing && ing.y > 650) {
                    ing.destroy(); combo = 1;
                    playNote(80, 'square', 0.1);
                    updateUI('MISS', '#ff0000');
                }
            });
        }

        function startGame() {
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
                isPlaying = true;
                if (audioCtx.state === 'suspended') audioCtx.resume();
            }, 500);
        }

        function submitZKProof() {
            isPlaying = false;
            const btn = document.querySelector('.btn-stellar');
            btn.innerText = "GENERATING PROOF...";
            btn.disabled = true;

            setTimeout(() => {
                alert(`üï∂Ô∏è CONSIGLIERE SLICE REPORT:\n\n1. Proving Score: ${score}\n2. Noir Circuit Verified: OK\n3. Proof sent to Soroban Contract: SUCCESS\n\nLa familia est√° orgullosa. Tu r√©cord ha sido inmortalizado en Stellar.`);
                btn.innerText = "SUBMIT TO STELLAR";
                btn.disabled = false;
                isPlaying = true;
            }, 2000);
        }
    </script>
</body>
</html>
