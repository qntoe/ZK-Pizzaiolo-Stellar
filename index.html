<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK-Pizzaiolo: Rhythm Arcade üï∂Ô∏èüçï</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background-color: #050505;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif;
            color: #00ffcc;
        }
        #game-container {
            border: 4px solid #ff00ff;
            box-shadow: 0 0 30px #ff00ff, inset 0 0 15px #ff00ff;
            border-radius: 12px;
            background: #000;
        }
        .ui-panel {
            margin-top: 20px;
            text-align: center;
            background: rgba(0, 255, 204, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #00ffcc;
            width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-stellar {
            background: #ff00ff;
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            text-transform: uppercase;
            transition: 0.3s;
            box-shadow: 0 0 10px #ff00ff;
        }
        .btn-stellar:hover {
            background: #fff;
            color: #ff00ff;
            box-shadow: 0 0 20px #fff;
        }
        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3.5rem;
            margin: 0 0 15px 0;
            color: #ff00ff;
            text-shadow: 0 0 15px #ff00ff, 0 0 30px #ff00ff;
        }
        .controls-hint {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <h1>ZK-Pizzaiolo</h1>
    <div id="game-container"></div>

    <div class="ui-panel">
        <div>
            <div id="status" style="font-size: 1.2rem; font-weight: bold;">SCORE: 0 | COMBO: x1</div>
            <div class="controls-hint">Teclas: [A] [S] [K] [L] para cada carril</div>
        </div>
        <div id="feedback" style="font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px #fff;">READY?</div>
        <button class="btn-stellar" onclick="submitZKProof()">Submit to Stellar</button>
    </div>

    <script>
        const config = {
            type: Phaser.AUTO,
            parent: 'game-container',
            width: 800,
            height: 600,
            physics: {
                default: 'arcade',
                arcade: { debug: false }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);
        
        // Carriles (Lanes)
        const LANES = [200, 333, 466, 600];
        const KEYS = ['A', 'S', 'K', 'L'];
        const LANE_COLORS = [0x00ffcc, 0xff00ff, 0x00ffcc, 0xff00ff];
        
        let ingredients;
        let score = 0;
        let combo = 1;
        let keyObjects = {};
        let hitZones = [];

        function preload() {}

        function create() {
            const self = this;
            
            // Fondo con rejilla perspectiva
            const graphics = this.add.graphics();
            graphics.lineStyle(2, 0x1a1a1a);
            for(let i=0; i<=800; i+=40) { graphics.lineBetween(i, 0, i, 600); }
            for(let i=0; i<=600; i+=40) { graphics.lineBetween(0, i, 800, i); }

            // Dibujar Carriles
            LANES.forEach((x, i) => {
                // Glow de carril
                const beam = this.add.rectangle(x, 300, 60, 600, LANE_COLORS[i], 0.05);
                
                // Zona de impacto (Hit Zone)
                const zone = this.add.circle(x, 530, 35, 0x000000);
                zone.setStrokeStyle(3, LANE_COLORS[i]);
                hitZones.push(zone);

                // Letra de control
                this.add.text(x - 10, 565, KEYS[i], { 
                    fontFamily: 'Orbitron', fontSize: '20px', fill: '#666' 
                });

                // Registrar Teclas
                keyObjects[KEYS[i]] = this.input.keyboard.addKey(KEYS[i]);
                
                // Evento de tecla presionada
                keyObjects[KEYS[i]].on('down', () => {
                    checkHit.call(self, i);
                    // Efecto visual de tecla
                    zone.setFillStyle(LANE_COLORS[i], 0.3);
                    self.time.delayedCall(100, () => zone.setFillStyle(0x000000, 0));
                });
            });

            ingredients = this.physics.add.group();

            // Spawn loop din√°mico (BPM)
            this.time.addEvent({
                delay: 800,
                callback: spawnIngredient,
                callbackScope: this,
                loop: true
            });
        }

        function spawnIngredient() {
            const laneIndex = Phaser.Math.Between(0, 3);
            const x = LANES[laneIndex];
            
            const ing = this.add.circle(x, -50, 25, LANE_COLORS[laneIndex]);
            ing.setStrokeStyle(2, 0xffffff);
            ing.setData('lane', laneIndex);
            
            ingredients.add(ing);
            ing.body.setVelocityY(400); // Velocidad constante para ritmo
        }

        function checkHit(laneIndex) {
            let hitFound = false;
            ingredients.children.iterate((ing) => {
                if (!ing || ing.getData('lane') !== laneIndex) return;

                const distance = Math.abs(ing.y - 530);
                
                if (distance < 70) {
                    hitFound = true;
                    processHit.call(this, ing, distance);
                }
            });

            if (!hitFound) {
                // Ghost hit / Miss
                combo = 1;
                updateUI('MISS', '#ff0000');
            }
        }

        function processHit(ing, dist) {
            ing.destroy();
            let points = 0;
            let label = '';
            let color = '';

            if (dist < 20) {
                points = 200; label = 'PERFECT!'; color = '#fffb00';
            } else if (dist < 45) {
                points = 100; label = 'GOOD'; color = '#00ffcc';
            } else {
                points = 50; label = 'OK'; color = '#ff00ff';
            }

            score += points * combo;
            combo++;
            
            updateUI(label, color);
            
            // Efecto de part√≠culas (falso)
            this.cameras.main.shake(100, 0.005);
        }

        function updateUI(label, color) {
            const fb = document.getElementById('feedback');
            fb.innerText = label;
            fb.style.color = color;
            fb.style.textShadow = `0 0 15px ${color}`;
            
            document.getElementById('status').innerText = `SCORE: ${score} | COMBO: x${combo}`;
        }

        function update() {
            ingredients.children.iterate((ing) => {
                if (ing && ing.y > 650) {
                    ing.destroy();
                    combo = 1;
                    updateUI('MISS', '#ff0000');
                }
            });
        }

        function submitZKProof() {
            alert(`üõ°Ô∏è Consigliere Slice: Generando Prueba ZK...\nPuntaje Verificado: ${score}\nEnviando a Stellar Soroban...`);
        }
    </script>
</body>
</html>
